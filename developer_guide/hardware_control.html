<!doctype html>
<html class="no-js" lang="en">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />
<link rel="index" title="Index" href="../genindex.html" /><link rel="search" title="Search" href="../search.html" /><link rel="next" title="Multiprocessing" href="multiprocessing.html" /><link rel="prev" title="Code architecture" href="code_architecture.html" />

    <!-- Generated with Sphinx 5.0.2 and Furo 2023.03.27 -->
        <title>Hardware Control - Sashimi</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo.css?digest=fad236701ea90a88636c2a8c73b44ae642ed2a53" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo-extensions.css?digest=30d1aed668e5c3a91c3e3bf6a60b675221979f0e" />
    
    


<style>
  body {
    --color-code-background: #eeffcc;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../index.html"><div class="brand">Sashimi</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand centered" href="../index.html">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo" src="../_static/main_icon.png" alt="Logo"/>
  </div>
  
  <span class="sidebar-brand-text">Sashimi</span>
  
</a><form class="sidebar-search-container" method="get" action="../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Overview</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../overview/intro.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../overview/structure.html">The structure of Sashimi</a></li>
<li class="toctree-l1"><a class="reference internal" href="../overview/features.html">Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="../overview/FAQ.html">FAQ</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">User Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../user_guide/installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_guide/configuration.html">Configuring Sashimi</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_guide/usage_example.html">Setting up the Lighsheet</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_guide/hardware_support.html">Hardware support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_guide/GUI.html">GUI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_guide/calibration.html">Calibration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_guide/planar_mode.html">Planar mode</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_guide/volume_mode.html">Volume mode</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Developer Guide</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="code_architecture.html">Code architecture</a></li>
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">Hardware Control</a></li>
<li class="toctree-l1"><a class="reference internal" href="multiprocessing.html">Multiprocessing</a></li>
<li class="toctree-l1"><a class="reference internal" href="scanning.html">Scanning</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Hardware</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../hardware/hardware.html">Microscope Hardware</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Api</span></p>
<ul>
<li class="toctree-l1 has-children"><a class="reference internal" href="../api/index.html">API Reference</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../api/sashimi.events.html">sashimi.events</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/sashimi.events.AutoName.html">sashimi.events.AutoName</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/sashimi.events.Enum.html">sashimi.events.Enum</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/sashimi.events.LoggedEvent.html">sashimi.events.LoggedEvent</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/sashimi.events.SashimiEvents.html">sashimi.events.SashimiEvents</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/sashimi.events.auto.html">sashimi.events.auto</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../api/sashimi.hardware.cameras.html">sashimi.hardware.cameras</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/sashimi.hardware.cameras.HamamatsuCamera.html">sashimi.hardware.cameras.HamamatsuCamera</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/sashimi.hardware.cameras.MockCamera.html">sashimi.hardware.cameras.MockCamera</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../api/sashimi.utilities.html">sashimi.utilities</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/sashimi.utilities.Enum.html">sashimi.utilities.Enum</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/sashimi.utilities.SpeedyArrayBuffer.html">sashimi.utilities.SpeedyArrayBuffer</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/sashimi.utilities.Empty.html">sashimi.utilities.Empty</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../api/sashimi.processes.logging.html">sashimi.processes.logging</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" role="switch" type="checkbox"/><label for="toctree-checkbox-5"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/sashimi.processes.logging.ConcurrenceLogger.html">sashimi.processes.logging.ConcurrenceLogger</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/sashimi.processes.logging.Enum.html">sashimi.processes.logging.Enum</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/sashimi.processes.logging.LoggingProcess.html">sashimi.processes.logging.LoggingProcess</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/sashimi.processes.logging.Path.html">sashimi.processes.logging.Path</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/sashimi.processes.logging.Process.html">sashimi.processes.logging.Process</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/sashimi.processes.logging.TextIO.html">sashimi.processes.logging.TextIO</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../api/sashimi.config.html">sashimi.config</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" role="switch" type="checkbox"/><label for="toctree-checkbox-6"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/sashimi.config.Path.html">sashimi.config.Path</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../api/sashimi.hardware.scanning.html">sashimi.hardware.scanning</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" role="switch" type="checkbox"/><label for="toctree-checkbox-7"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/sashimi.hardware.scanning.ABC.html">sashimi.hardware.scanning.ABC</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/sashimi.hardware.scanning.AbstractScanInterface.html">sashimi.hardware.scanning.AbstractScanInterface</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/sashimi.hardware.scanning.ScanningError.html">sashimi.hardware.scanning.ScanningError</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">References</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../overview/references.html">Bibliography</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <section class="tex2jax_ignore mathjax_ignore" id="hardware-control">
<h1>Hardware Control<a class="headerlink" href="#hardware-control" title="Permalink to this heading">#</a></h1>
<p>One of the strengths of <strong>Sashimi</strong> is the smart use of interfaces for the connection with potentially any hardware component. Whenever a component needs to be swapped it can be easily done by just creating a custom python file for its connection to the Sashimi interface. The main hardware components needed are a <code class="docutils literal notranslate"><span class="pre">light</span> <span class="pre">source</span></code> (laser), a <code class="docutils literal notranslate"><span class="pre">camera</span></code>, a <code class="docutils literal notranslate"><span class="pre">piezo</span></code> and multiple <code class="docutils literal notranslate"><span class="pre">galvos</span></code> for directing the laser and creating a sheet of light, and, finally, a <code class="docutils literal notranslate"><span class="pre">board</span></code> to drive most of the triggers. Each interface is defined as an <code class="docutils literal notranslate"><span class="pre">Abstract</span></code> class which ensures that while creating a new custom module, inheriting from the interface, all the functions and properties necessary for the software to work will be implemented.</p>
<p>Another means of interaction with the hardware, but also the software, is the sashimi-config module that lets the user interact with software settings from the command line. This enables easy and quick access to some fixed settings that are used over the whole software. An example of which is the maximum resolution of the camera sensor, the default save path, the channels of the NI board, and so on.</p>
<section id="light-source-interface">
<h2>Light-Source Interface<a class="headerlink" href="#light-source-interface" title="Permalink to this heading">#</a></h2>
<p>The light source interface enforces that any custom light source module defines a method for setting the power of the laser, a method for closing the laser, and properties for reading the intensity of the laser and the status (ON, OFF).
At the moment, only two modules are present in the software:</p>
<ul class="simple">
<li><p>Mock light source, which mocks the behavior of the light source and it’s used mainly for testing purposes.</p></li>
<li><p>Cobolt light source, which takes care of the opening and setting up of the Cobolt laser.</p></li>
</ul>
</section>
<section id="camera-interface">
<h2>Camera Interface<a class="headerlink" href="#camera-interface" title="Permalink to this heading">#</a></h2>
<p>The camera interface outlines the functions and properties needed for the control of the camera and the adjustment of the most relevant settings. The core methods are start/stop acquisition, shut down the camera, and most importantly, <code class="docutils literal notranslate"><span class="pre">get_frames</span></code> that return a list of images.</p>
<p>Using the camera interface it is possible to change the following properties:</p>
<ul class="simple">
<li><p>Binning size</p></li>
<li><p>Exposure time</p></li>
<li><p>Trigger mode, which is expected to be external for Sashimi volumetric mode</p></li>
<li><p>Frame Rate, which can only be read (to change this value you’ll need to change the exposure time)</p></li>
<li><p>Sensor resolution, which computes the resolution based on the binning size and the maximum resolution (setting to be defined in the configuration file)</p></li>
</ul>
<p>For this interface there’s a mock module which displays a gaussian filtered noise image, and a module for the Hamamatsu Orca flash 4.0 v3 camera.</p>
</section>
<section id="external-trigger-interface">
<h2>External-Trigger Interface<a class="headerlink" href="#external-trigger-interface" title="Permalink to this heading">#</a></h2>
<p>The external trigger interface allows synchronizing Sashimi with behavioral software for stimulus presentation and behavioral tracking. To achieve this it uses the python bindings of ZeroMQ[<span class="xref myst">5</span>], a high-performance asynchronous messaging library. The interface takes care of establishing the connection to the other software and returning the total duration of the experiment protocol. The duration will be then used by the external communication process to update the acquisition duration of the experiment inside Sashimi.</p>
<p>There’s a module that allows for a built-in connection between Sashimi and <a class="reference external" href="https://www.portugueslab.com/stytra/index.html">Stytra</a> [<span class="xref myst">1</span>],[<span class="xref myst">2</span>], an open-source software package, designed to cover all the general requirements involved in larval zebrafish behavioral experiments. Once an experiment protocol is ready, and both software are set up correctly, <a class="reference external" href="https://www.portugueslab.com/stytra/index.html">Stytra</a> will stand by and wait for a message from the acquisition software (Sashimi) to start the experiment. This message is automatically sent once the acquisition start is triggered in the Sashimi GUI.</p>
</section>
<section id="scanning-interface">
<h2>Scanning Interface<a class="headerlink" href="#scanning-interface" title="Permalink to this heading">#</a></h2>
<p>The scanning interface is the more complicated interface since it needs to handle the NI board which in turn controls the scanning hardware.
This interface outlines three simple methods to write and read samples from the board, as well as initialization of the board and start of the relevant tasks.
There are multiple properties that control different functionalities:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">z_piezo</span></code>, reads and writes values to move the piezo vertically.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">z_frontal</span></code>, reads and writes values to move the frontal laser vertically.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">xy_frontal</span></code>, reads and writes values to move the frontal laser horizontally.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">z_lateral</span></code>, reads and writes values to move the lateral laser vertically.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">xy_lateral</span></code>, reads and writes values to move the lateral laser horizontally.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Camera_trigger</span></code>, triggers the acquisition of one frame.</p></li>
</ul>
<p>The implementation of the scanning interfaces connects to the NI board and initialize three analog streams:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">xy_writer</span></code>, which combines the frontal and lateral galvos moving the laser horizontally and outputs a waveform.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">z_reader</span></code>, which reads the piezo position.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">z_writer</span></code>, which combines the frontal and lateral galvos moving the laser vertically, the piezo and the camera trigger.   For each of them the output varies depending on the mode in which the software is.</p></li>
</ul>
<p>Inside the config file, there’s a factor that allows applying a rescaling factor to the piezo.</p>
<p>Another major part of the interface is the implementation of different scanning loops to continuously move the laser to form a sheet of light and move it in z synchronously with the piezo to keep the focus. There is a main class called ScanLoop which continuously checks whether the settings have changed, fills the input arrays with the appropriate waveform, writes this array on the NI board (through the scanning interface), reads the values from the NI board, and keeps a count of the current written and read samples. Two classes inherit from this main class:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">PlanarScanLoop</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">VolumetricScanLoop</span></code></p></li>
</ul>
<p>The main difference between the two is the way they fill the arrays responsible to control the vertical movement of Piezo and galvos. Inside the <code class="docutils literal notranslate"><span class="pre">planar</span> <span class="pre">loop</span></code>, there are two possible modes, one of which is used for calibration purposes and is completely manual. In this mode, the piezo is moved independently of the lateral and frontal vertical galvos. This allows for proper calibration of the focus plane for each specimen placed in the microscope. The other mode is synched and uses the linear function computed by the calibration to compute the appropriate value for each galvo, based on the piezo position.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">volumetric</span> <span class="pre">loop</span></code> instead writes a sawtooth waveform to the piezo, then reads the piezo position and computes the appropriate value to set the vertical galvos to. Given the desired framerate, it will also generate an array of impulses for the camera trigger, where the initial or final frame can be skipped depending on the waveform of the piezo. For ease of use, the waveform is shown in the GUI so that the user can decide how many frames to skip depending on the settings that they inserted, see <a class="reference internal" href="../user_guide/volume_mode.html#sashimi-mode-vol"><span class="std std-ref">figure</span></a> , where the white line represents the waveform.</p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./developer_guide"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>
        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="multiprocessing.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Multiprocessing</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="code_architecture.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Code architecture</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; Portugues lab
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Hardware Control</a><ul>
<li><a class="reference internal" href="#light-source-interface">Light-Source Interface</a></li>
<li><a class="reference internal" href="#camera-interface">Camera Interface</a></li>
<li><a class="reference internal" href="#external-trigger-interface">External-Trigger Interface</a></li>
<li><a class="reference internal" href="#scanning-interface">Scanning Interface</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js"></script>
    <script src="../_static/scripts/furo.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    </body>
</html>